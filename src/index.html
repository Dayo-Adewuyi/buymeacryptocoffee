<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Quicksand&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="../stylesheets/style.css">
        <title>Donation</title>
    </head>

    <body>
        <div class="container-fluid">
            <div class = "row header">
                <div class = "col-md-2"></div>
                <div class="col-md-8">
                    <div class="row menu">
                        <span class="col-md-6">
                            <a class="header-button" id="generate" href="#generateLink">Generate</a>
                        </span>
                        <span class="col-md-6">
                            <a class="header-button" id="donate" href="#donateToken">Donate</a>
                        </span>
                    </div>
                    <script>
                        $( () => {
                            $('.menu a').bind('click', function() {
                                $('.menu a').removeClass('clicked');
                                $(this).addClass('clicked');
                            })
                        })
                    </script>
                </div>
                <div class = "col-md-2"></div>
            </div>
            <div class="row" id="generateLink">
                <div class="col-md-2">
                    
                </div>
                <div class="col-md-8">
                    <div class="" id="generate-link">
                        <h4>Generate donation link</h4>
                        <div class="inputs">
                            <div style="padding:20px;">
                                <span>Address</span>
                                <input id="address" class="texts" autocomplete="off" autocorrect="off" type="text" placeholder="0x0" minlength="42" maxlength="64" spellcheck="false">
                            </div>
                            <div style="padding:20px;">
                                <span>Amount (ETH)</span>
                                <input type="number" id="amount" placeholder="0.1" step=".001", min="0" maxlength="5" onkeypress="return event.charCode > 45">
                            </div> 
                        </div>
                        <div class="">
                            <!--<button disabled class="submit" style="background-color: #ffffff; color: black;" id="enterAddress">Enter wallet address</button>
                            <button disabled class="submit" style="background-color: #c3c5cb;" id="enterAmount">Enter token amount</button>
                            --><button type="submit" class="submit" style="background-color: #2172e4;" id="create">Generate</button>
                        
                            <script>
                                $(document).ready(function(){
                                    $('.modal-content').hide();
                                   /** $('#enterAmount').hide();
                                    $('#create').hide();
                                    $('.modal-content').hide();

                                    $('#address').click(async () => {
                                        $('#enterAddress').show();
                                        $('#enterAmount').hide();
                                        $('#create').hide();
                                    })

                                    $('#amount').click(async () => {
                                        $('#enterAddress').hide();
                                        $('#enterAmount').show();
                                        $('#create').hide();
                                    })**/

                                    $(".texts").change(function() {
                                        if($('#address').val().replace(/\s/g, "") === "") {
                                            $document.getElementById('create').disabled = true;
                                        } else {
                                            $document.getElementById('create').disabled = false;
                                            //$('#enterAddress').hide();
                                            //$('#enterAmount').hide();
                                        }
                                    });

                                    $('#create').click(()=>{
                                        let url = "https://crypto-donations.netlify.app/";
                                        if($('#address').val().replace(/\s/g, "") !== "") {
                                            url = url + "?daddress=" + $('#address').val().replace(/\s/g, "");
                                        }
                                        if($('#amount').val().replace(/\s/g, "") !== "") {
                                            url = url + "&damount=" + $('#amount').val().replace(/\s/g, "");
                                        }
                                        console.log(url)
                                        $('a.copy').attr('href', url);
                                        $('a.visit').attr('href', url);
                                        $('.modal-content').show();
                                    })
                                    
                                })
                            </script>
                        </div>
                    </div>
                </div>
                <div class="col-md-2">
                    
                </div>
            </div>
            <div class="row" id="donateToken">
                <div class="col-md-2">
                    
                </div>
                <div class="col-md-8">
                    <form action="#", onsubmit="return false" name="MyForm">
                    <div class="" id="donate-token">
                        <h4>Donate</h4>
                        <div class="inputs">
                            <div style="padding:20px;">
                                <span>Address</span>
                                <input id="daddress" class="texts" autocomplete="off" autocorrect="off" type="text" placeholder="0x0" minlength="1" maxlength="64" spellcheck="false">
                            </div>
                            <div style="padding:20px;">
                                <span>Amount (ETH)</span>
                                <input type="number" id="damount" placeholder="0.1" step=".001", min="0" maxlength="5" onkeypress="return event.charCode > 45">
                            </div> 
                        </div>
                        <div class="">
                            <button class="submit" style="background-color: #2172e4;" id="btn">Donate</button>
                        </div>
                    </div>
                </form>
                <script type="text/javascript" language="JavaScript">
                    function FillForm() {
                    // Specify form's name between the quotes on next line.
                    var FormName = "MyForm";
                    var questionlocation = location.href.indexOf('?');
                    if(questionlocation < 0) { return; }
                    var q = location.href.substr(questionlocation + 1);
                    var list = q.split('&');
                    for(var i = 0; i < list.length; i++) {
                       var kv = list[i].split('=');
                       if(! eval('document.'+ FormName+'.'+kv[0])) { continue; }
                       kv[1] = unescape(kv[1]);
                       if(kv[1].indexOf('"') > -1) {
                          var re = /"/g;
                          kv[1] = kv[1].replace(re,'\\"');
                          }
                       eval('document.'+FormName+'.'+kv[0]+'.value="'+kv[1]+'"');
                       }
                    }
                    FillForm();
                    //-->

                    $(document).ready(function(){
                        let address = document.getElementById('daddress').value;
                        let amount = document.getElementById('damount').value;
                        console.log(window.location.href)

                        if (window.location.href !== "https://crypto-donations.netlify.app/" && window.location.href !== "https://crypto-donations.netlify.app/#generateLink") {
                            if (address.replace(/\s/g, "") === "" || amount.replace(/\s/g, "") === "") {
                                $('#donate').trigger("click", async () => {
                                })
                                //window.location.href = 'http://localhost:1234/#donateToken';
                                //document.getElementById('btn').disabled = true;
                            } else {
                                $('#donate').trigger("click", async () => {
                                })
                                
                                //document.getElementById('btn').disabled = false;
                                $('#btn').trigger("click", async () => {
                                })
                            }
                        }
                    })
                    </script>
                                        
                </div>
                <div class="col-md-2">
                    
                </div>
            </div>
            <script>
                $('#donateToken').hide();
                
                $('#generate').click(() => {
                    $('#error-message').innerHTML = "";
                    $('#generateLink').show();
                    $('#donateToken').hide();
                })

                $('#donate').click(() => {
                    $('#generateLink').hide();
                    $('#donateToken').show();
                })
            </script>
            <div class="modal-content" style="text-align:center;">
                <span class="close">&times;</span>
               <!-- <p>Copy donation link</p>-->
                <p><a class="copy" data-toggle="tooltip" title="Copy to Clipboard">Copy link to clipboard <i class="fa fa-copy"></i></a></p>
                <p><a class="visit">Visit link</a></p>
                <script>
                    $(document).ready(function(){
                        $('.copy').click(function (e) {
                            e.preventDefault();
                            var copyText = $(this).attr('href');
                         
                            document.addEventListener('copy', function(e) {
                               e.clipboardData.setData('text/plain', copyText);
                               e.preventDefault();
                            }, true);
                         
                            document.execCommand('copy');  
                            console.log('copied link : ', copyText);
                          });
                    })
                </script>
            </div>
            <p id="error-message" style="text-align:center; color:red;"></p>
            <p id="success-message" style="text-align:center; color:green;"></p>
        </div>
        
        <script type="module" src="./app.ts"></script>
    </body>
</html>